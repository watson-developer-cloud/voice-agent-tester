{
"map": "function (doc) {\n  var regex=/([a-z]|[0-9])+_([[a-z]|[0-9])+/\n  if(doc._id && regex.test(doc._id) && doc.masterJobId){\n    var status = [\n                        'created',\n                        'starting',\n                        're-starting',\n                        'running',\n                        'completed',\n                        'failed',\n                        'paused',\n                        'pausing',\n                        'stopped',\n                        'stopping',\n                        'invalid',\n                        'percentComplete',\n                        'jobsWithPercentage'\n                      ];\n    result = {};\n    status.forEach(function(status) {result[status] = 0});\n    result[doc.status]=1;\n    if(doc.percentComplete>=0){\n      result['percentComplete']=doc.percentComplete\n      result['jobsWithPercentage']=1\n    }\n    result['maxStopTime']=doc.stopTime || null\n    result['id']=doc._id\n    result['status']=doc.status\n    result['failures']=doc.results.numberOfFailures\n    result['maxStopTime']=doc.stopTime || null\n    emit(doc.masterJobId, result); \n  }\n}",
"reduce": "function (keys, values, rereduce) {\n  var status = [\n                        'created',\n                        'starting',\n                        're-starting',\n                        'running',\n                        'completed',\n                        'failed',\n                        'paused',\n                        'pausing',\n                        'stopped',\n                        'stopping',\n                        'invalid',\n                        'percentComplete',\n                        'maxStopTime',\n                        'jobsWithPercentage',\n                        'failures'\n                      ];\n  result = {};\n  status.forEach(function(stat) {result[stat] = 0});\n  result['id']=null\n  result['status']=null\n  var maxStop=null;\n  values.forEach(function(mappedValue){\n    status.forEach(function(stat) {\n      if(stat==='maxStopTime'){\n        if(maxStop===null || maxStop<mappedValue[stat])\n          maxStop=mappedValue[stat];\n      }\n      else\n        result[stat] += mappedValue[stat];\n    });\n  });\n  result['maxStopTime']=maxStop;\n  return result;\n}"
}